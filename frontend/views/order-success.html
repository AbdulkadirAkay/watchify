<style>
    .success-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    
    .success-icon {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        animation: bounceIn 0.8s ease-out;
    }
    
    .success-icon i {
        font-size: 2.5rem;
        color: #28a745;
    }
    
    @keyframes bounceIn {
        0% {
            transform: scale(0.3);
            opacity: 0;
        }
        50% {
            transform: scale(1.05);
        }
        70% {
            transform: scale(0.9);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    .order-details-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .detail-row:last-child {
        border-bottom: none;
    }
    
    .order-item {
        border-bottom: 1px solid #e9ecef;
        padding: 1rem 0;
    }
    
    .order-item:last-child {
        border-bottom: none;
    }
    
    .info-box {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 0 8px 8px 0;
    }
</style>

<!-- Success Header -->
<div class="success-header">
    <div class="container">
        <div class="text-center">
            <div class="success-icon">
                <i class="bi-check-lg"></i>
            </div>
            <h1 class="display-4 fw-bold mb-3">Order Successful!</h1>
            <p class="lead mb-0">Thank you for your purchase! Your order has been confirmed.</p>
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Order Details Card -->
            <div class="order-details-card">
                <h5 class="mb-3">
                    <i class="bi-receipt me-2"></i>
                    Order Details
                </h5>
                
                <div class="detail-row">
                    <span>Order Number:</span>
                    <strong id="orderNumber">#ORD-XXXX</strong>
                </div>
                
                <div class="detail-row">
                    <span>Order Date:</span>
                    <span id="orderDate"></span>
                </div>
                
                <div class="detail-row">
                    <span>Payment Method:</span>
                    <span id="paymentMethod">N/A</span>
                </div>
                
                <div class="detail-row">
                    <span>Shipping Address:</span>
                    <span id="shippingAddress">N/A</span>
                </div>
            </div>
            
            <!-- Order Items Card -->
            <div class="order-details-card">
                <h5 class="mb-3">
                    <i class="bi-bag me-2"></i>
                    Order Items
                </h5>
                
                <div id="orderItems">
                    <!-- Items will be dynamically inserted here -->
                </div>
                
                <hr>
                
                <div class="detail-row">
                    <span>Subtotal:</span>
                    <span id="subtotalAmount">$0.00</span>
                </div>
                <div class="detail-row">
                    <span>Shipping:</span>
                    <span>Free</span>
                </div>
                <div class="detail-row">
                    <strong>Total:</strong>
                    <strong id="totalAmount">$0.00</strong>
                </div>
            </div>
            
            <!-- Information Box -->
            <div class="info-box">
                <h6 class="mb-2">
                    <i class="bi-info-circle me-2"></i>
                    What's Next?
                </h6>
                <p class="mb-2">
                    <i class="bi-envelope me-2"></i>
                    A confirmation email has been sent to your registered email address.
                </p>
                <p class="mb-0">
                    <i class="bi-truck me-2"></i>
                    Your order is being prepared for shipment. Expected delivery: <strong>3-5 business days</strong>
                </p>
            </div>
            
            <!-- Action Buttons -->
            <div class="text-center mt-4">
                <a href="#profile" class="btn btn-primary me-2">
                    <i class="bi-person me-2"></i>
                    View Order History
                </a>
                <a href="#home" class="btn btn-outline-secondary">
                    <i class="bi-house me-2"></i>
                    Continue Shopping
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Load order details
function loadOrderDetails() {
    var orderDetailsJson = localStorage.getItem('last_order');
    
    if (!orderDetailsJson) {
        // No order details found, redirect to home
        console.warn('No order details found');
        window.location.hash = '#home';
        return;
    }
    
    try {
        var orderDetails = JSON.parse(orderDetailsJson);
        
        // Display order number
        $('#orderNumber').text('#ORD-' + (orderDetails.orderId || 'XXXX'));
        
        // Display order date
        var orderDate = new Date(orderDetails.date);
        var options = { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        };
        $('#orderDate').text(orderDate.toLocaleDateString('en-US', options));
        
        // Display payment method
        var paymentMethodText = orderDetails.paymentMethod;
        if (paymentMethodText === 'credit_card') {
            paymentMethodText = 'Credit Card';
        } else if (paymentMethodText === 'debit_card') {
            paymentMethodText = 'Debit Card';
        } else if (paymentMethodText === 'paypal') {
            paymentMethodText = 'PayPal';
        }
        $('#paymentMethod').text(paymentMethodText);
        
        // Display shipping address
        $('#shippingAddress').text(orderDetails.address || 'N/A');
        
        // Display order items
        var $orderItems = $('#orderItems');
        $orderItems.empty();
        
        if (orderDetails.items && orderDetails.items.length > 0) {
            orderDetails.items.forEach(function(item) {
                var img = item.image_url || 'images/no-image-placeholder.png';
                var price = parseFloat(item.price) || 0;
                var itemTotal = (price * item.quantity).toFixed(2);
                
                var itemHtml = `
                    <div class="order-item">
                        <div class="row align-items-center">
                            <div class="col-2">
                                <img src="${img}" class="img-fluid rounded" alt="${item.name || ''}">
                            </div>
                            <div class="col-6">
                                <h6 class="mb-1">${item.name || 'Unnamed product'}</h6>
                                <p class="text-muted mb-0 small">${item.brand || ''}</p>
                                <small class="text-muted">Qty: ${item.quantity}</small>
                            </div>
                            <div class="col-4 text-end">
                                <p class="mb-0">$${price.toFixed(2)} Ã— ${item.quantity}</p>
                                <strong>$${itemTotal}</strong>
                            </div>
                        </div>
                    </div>
                `;
                
                $orderItems.append(itemHtml);
            });
        }
        
        // Display totals
        $('#subtotalAmount').text('$' + (orderDetails.total || '0.00'));
        $('#totalAmount').text('$' + (orderDetails.total || '0.00'));
        
        // Clear stored order details after displaying (optional - comment out if you want to keep it)
        // localStorage.removeItem('last_order');
        
    } catch (error) {
        console.error('Error loading order details:', error);
        if (typeof Utils !== "undefined" && Utils.showError) {
            Utils.showError('Failed to load order details.');
        }
    }
}

// Initialize on page load
if (window.location.hash.includes("#order-success")) {
    loadOrderDetails();
}

// Listen for hash changes
$(window).on('hashchange', function() {
    if (window.location.hash.includes("#order-success")) {
        loadOrderDetails();
    }
});
</script>
