<style>
    .brand-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    
    .brand-breadcrumb {
        background-color: #f8f9fa;
        padding: 1rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .breadcrumb {
        margin-bottom: 0;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        content: ">";
    }
    
    .products-grid {
        padding: 2rem 0;
    }
    
    .product-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .product-image {
        height: 250px;
        object-fit: cover;
        border-radius: 8px 8px 0 0;
    }
    
    .sale-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        z-index: 2;
    }
    
    .price-original {
        text-decoration: line-through;
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .price-sale {
        color: #dc3545;
        font-weight: 600;
    }
    
    .btn-add-cart {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-weight: 500;
        transition: transform 0.3s ease;
    }
    
    .btn-add-cart:hover {
        transform: translateY(-2px);
        color: white;
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 3rem;
    }
    
    .no-products {
        text-align: center;
        padding: 3rem;
        color: #6c757d;
    }
    
    .brand-logo {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .brand-logo i {
        font-size: 2rem;
        color: #667eea;
    }
</style>

<!-- Brand Header -->
<div class="brand-header">
    <div class="container">
        <div class="text-center">
            <div class="brand-logo">
                <i class="bi-award" id="brandIcon"></i>
            </div>
            <h1 class="display-4 fw-bold mb-3" id="brandTitle">Loading Brand...</h1>
            <p class="lead mb-0" id="brandDescription">Discover our premium collection</p>
        </div>
    </div>
</div>

<!-- Breadcrumb -->
<div class="brand-breadcrumb">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#home" class="text-decoration-none">Home</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none" id="breadcrumbBrand">Brands</a></li>
                <li class="breadcrumb-item active" aria-current="page" id="breadcrumbCurrent">Products</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container">
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading brand products...</p>
    </div>
    
    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
        <div class="row gx-4 gx-lg-5 row-cols-1 row-cols-md-2 row-cols-xl-4" id="productsContainer">
            <!-- Products will be loaded here -->
        </div>
    </div>
    
    <!-- No Products Message -->
    <div class="no-products" id="noProducts" style="display: none;">
        <i class="bi-box display-1 text-muted"></i>
        <h4 class="mt-3">No products found</h4>
        <p class="text-muted">We couldn't find any products for this brand.</p>
        <a href="#home" class="btn btn-primary">Continue Shopping</a>
    </div>
</div>

<script>
// Sample products data (in a real app, this would come from an API)
const brandProductsData = [
    {
        id: 1,
        name: "Fancy Product",
        price: 80.00,
        originalPrice: null,
        image: "images/rolex.png",
        category: "men",
        brand: "Rolex",
        onSale: false
    },
    {
        id: 2,
        name: "Special Item",
        price: 18.00,
        originalPrice: 20.00,
        image: "images/rolex.png",
        category: "women",
        brand: "Police",
        onSale: true
    },
    {
        id: 3,
        name: "Sale Item",
        price: 25.00,
        originalPrice: 50.00,
        image: "images/rolex.png",
        category: "men",
        brand: "Fossil",
        onSale: true
    },
    {
        id: 4,
        name: "Popular Item",
        price: 40.00,
        originalPrice: null,
        image: "images/rolex.png",
        category: "women",
        brand: "Festina",
        onSale: false
    }
];

// Brand mapping by ID (you can map these to your database)
const brandMapping = {
    '1': {
        title: 'Police Watches',
        description: 'Bold and distinctive Police watch collection',
        breadcrumb: 'Police Brand',
        icon: 'bi-shield-check'
    },
    '2': {
        title: 'Rolex Watches',
        description: 'Luxury timepieces from the world\'s most prestigious brand',
        breadcrumb: 'Rolex Brand',
        icon: 'bi-gem'
    },
    '3': {
        title: 'Fossil Watches',
        description: 'Modern and trendy Fossil watch collection',
        breadcrumb: 'Fossil Brand',
        icon: 'bi-clock'
    },
    '4': {
        title: 'Festina Watches',
        description: 'Quality timepieces with European style',
        breadcrumb: 'Festina Brand',
        icon: 'bi-star'
    },
    '5': {
        title: 'Patek Philippe Watches',
        description: 'Exclusive luxury watches from Patek Philippe',
        breadcrumb: 'Patek Philippe Brand',
        icon: 'bi-award'
    }
};

// Get brand ID from URL hash query parameters
function getBrandIdFromURL() {
    // Check if we have stored parameters first
    if (window.currentHashWithParams) {
        const hash = window.currentHashWithParams;
        if (hash.includes('?')) {
            const hashParts = hash.split('?');
            if (hashParts.length > 1) {
                const queryString = hashParts[1];
                const urlParams = new URLSearchParams(queryString);
                return urlParams.get('id') || '1';
            }
        }
    }
    
    // Fallback to current hash
    const hash = window.location.hash;
    let brandId = '1'; // default to ID 1
    
    if (hash.includes('?')) {
        const hashParts = hash.split('?');
        if (hashParts.length > 1) {
            const queryString = hashParts[1];
            const urlParams = new URLSearchParams(queryString);
            brandId = urlParams.get('id') || '1';
        }
    }
    
    return brandId;
}

// Load products based on brand ID
function loadBrandProducts() {
    const brandId = getBrandIdFromURL();
    console.log('Brand products page - Brand ID:', brandId);
    console.log('Current hash:', window.location.hash);
    console.log('Stored hash:', window.currentHashWithParams);
    
    // Show loading spinner
    $('#loadingSpinner').show();
    $('#productsGrid').hide();
    $('#noProducts').hide();
    
    // Simulate API call delay
    setTimeout(() => {
        // Get brand info
        const brandInfo = brandMapping[brandId] || brandMapping['1'];
        
        // Update page title and info
        $('#brandTitle').text(brandInfo.title);
        $('#brandDescription').text(brandInfo.description);
        $('#breadcrumbBrand').text(brandInfo.breadcrumb);
        $('#breadcrumbCurrent').text(brandInfo.title);
        $('#brandIcon').removeClass().addClass(brandInfo.icon);
        
        // Filter products by brand ID (in a real app, this would be done by the API)
        let filteredProducts = [];
        
        switch(brandId) {
            case '1': // Police brand
                filteredProducts = brandProductsData.filter(product => product.brand === 'Police');
                break;
            case '2': // Rolex brand
                filteredProducts = brandProductsData.filter(product => product.brand === 'Rolex');
                break;
            case '3': // Fossil brand
                filteredProducts = brandProductsData.filter(product => product.brand === 'Fossil');
                break;
            case '4': // Festina brand
                filteredProducts = brandProductsData.filter(product => product.brand === 'Festina');
                break;
            case '5': // Patek Philippe brand
                filteredProducts = brandProductsData.filter(product => product.brand === 'Patek Philippe');
                break;
            default:
                filteredProducts = brandProductsData.slice(0, 4); // Show first 4 products as fallback
        }
        
        // If no products found, show all products as fallback
        const productsToShow = filteredProducts.length > 0 ? filteredProducts : brandProductsData.slice(0, 4);
        
        // Render products
        renderProducts(productsToShow);
        
        // Hide loading spinner
        $('#loadingSpinner').hide();
        
        if (productsToShow.length > 0) {
            $('#productsGrid').show();
        } else {
            $('#noProducts').show();
        }
        
        // Add query parameter virtually to URL after items are loaded
        addQueryParameterToURL(brandId);
    }, 100);
}

// Render products
function renderProducts(products) {
    const container = $('#productsContainer');
    container.empty();
    
    products.forEach(product => {
        const productCard = createProductCard(product);
        container.append(productCard);
    });
}

// Create product card HTML
function createProductCard(product) {
    const saleBadge = product.onSale ? 
        '<div class="sale-badge">Sale</div>' : '';
    
    const priceHtml = product.originalPrice ? 
        `<span class="price-original">$${product.originalPrice.toFixed(2)}</span>
         <span class="price-sale">$${product.price.toFixed(2)}</span>` :
        `<span class="fw-bold">$${product.price.toFixed(2)}</span>`;
    
    return `
        <div class="col mb-5">
            <div class="card h-100 product-card position-relative">
                ${saleBadge}
                <img class="card-img-top product-image" src="${product.image}" alt="${product.name}" />
                <div class="card-body p-4">
                    <div class="text-center">
                        <h5 class="fw-bolder">${product.name}</h5>
                        <p class="text-muted mb-2">${product.brand}</p>
                        <div class="mb-3">
                            ${priceHtml}
                        </div>
                    </div>
                </div>
                <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                    <div class="text-center">
                        <button class="btn btn-add-cart w-100" onclick="addToCart(${product.id})">
                            <i class="bi-cart-plus me-2"></i>
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Add query parameter virtually to URL
function addQueryParameterToURL(brandId) {
    // Only add if we don't already have the parameter in the URL
    const currentHash = window.location.hash;
    const expectedHash = `#brand-products?id=${brandId}`;
    
    if (currentHash !== expectedHash) {
        // Use history.replaceState to update URL without triggering navigation
        const newURL = window.location.pathname + expectedHash;
        window.history.replaceState(null, '', newURL);
        
        // Update the stored hash with parameters
        window.currentHashWithParams = expectedHash;
    }
}

// Add to cart function
function addToCart(productId) {
    // Here you would typically add the product to cart
    console.log('Adding product to cart:', productId);
    
    // Show success message
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="bi-check me-2"></i>Added!';
    btn.classList.add('btn-success');
    btn.classList.remove('btn-add-cart');
    
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.classList.remove('btn-success');
        btn.classList.add('btn-add-cart');
    }, 2000);
}

// Initialize page
$(document).ready(function() {
    // Clear any old parameters from other pages and ensure we have the right ones
    if (window.currentHashWithParams && !window.currentHashWithParams.includes('brand-products')) {
        window.currentHashWithParams = null;
    }
    
    // Small delay to ensure everything is loaded
    setTimeout(function() {
        loadBrandProducts();
    }, 100);
});

// Listen for hash changes to reload products
$(window).on('hashchange', function() {
    const hash = window.location.hash;
    if (hash.startsWith('#brand-products')) {
        loadBrandProducts();
    }
});
</script>
