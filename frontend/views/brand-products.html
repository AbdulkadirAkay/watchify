<style>
    .brand-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
    }
    
    .brand-breadcrumb {
        background-color: #f8f9fa;
        padding: 1rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .breadcrumb {
        margin-bottom: 0;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        content: ">";
    }
    
    .products-grid {
        padding: 2rem 0;
    }
    
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 3rem;
    }
    
    .no-products {
        text-align: center;
        padding: 3rem;
        color: #6c757d;
    }
    
    .brand-logo {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .brand-logo i {
        font-size: 2rem;
        color: #667eea;
    }
</style>

<!-- Brand Header -->
<div class="brand-header">
    <div class="container">
        <div class="text-center">
            <div class="brand-logo">
                <i class="bi-award" id="brandIcon"></i>
            </div>
            <h1 class="display-4 fw-bold mb-3" id="brandTitle">Loading Brand...</h1>
            <p class="lead mb-0" id="brandDescription">Discover our premium collection</p>
        </div>
    </div>
</div>

<!-- Breadcrumb -->
<div class="brand-breadcrumb">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#home" class="text-decoration-none">Home</a></li>
                <li class="breadcrumb-item"><a href="#" class="text-decoration-none" id="breadcrumbBrand">Brands</a></li>
                <li class="breadcrumb-item active" aria-current="page" id="breadcrumbCurrent">Products</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container">
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading brand products...</p>
    </div>
    
    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
        <div class="row gx-4 gx-lg-5 row-cols-1 row-cols-md-2 row-cols-xl-4" id="productsContainer">
            <!-- Products will be loaded here -->
        </div>
    </div>
    
    <!-- No Products Message -->
    <div class="no-products" id="noProducts" style="display: none;">
        <i class="bi-box display-1 text-muted"></i>
        <h4 class="mt-3">No products found</h4>
        <p class="text-muted">We couldn't find any products for this brand.</p>
        <a href="#home" class="btn btn-primary">Continue Shopping</a>
    </div>
</div>

<script>
// Get brand name from URL hash query parameters
function getBrandFromURL() {
    const hash = window.location.hash;
    let brandName = null;
    
    if (hash && hash.includes('?')) {
        const hashParts = hash.split('?');
        if (hashParts.length > 1) {
            const queryString = hashParts[1];
            const urlParams = new URLSearchParams(queryString);
            brandName = urlParams.get('brand');
        }
    }
    
    return brandName;
}

// Load products based on brand name (from backend)
function loadBrandProducts() {
    const brandName = getBrandFromURL();
    
    if (!brandName) {
        Utils.showError("Brand not specified");
        $('#loadingSpinner').hide();
        $('#productsGrid').hide();
        $('#noProducts').show();
        return;
    }
    
    // Show loading spinner
    $('#loadingSpinner').show();
    $('#productsGrid').hide();
    $('#noProducts').hide();
    
    // Update page title and info with brand name
    $('#brandTitle').text(brandName + ' Watches');
    $('#brandDescription').text('Explore our collection of ' + brandName + ' watches');
    $('#breadcrumbBrand').text(brandName + ' Brand');
    $('#breadcrumbCurrent').text(brandName);
    $('#brandIcon').removeClass().addClass('bi-watch');
    
    RestClient.get(
        'api/products/brand/' + encodeURIComponent(brandName),
        function(res) {
            $('#loadingSpinner').hide();
            
            if (!res || !res.success || !Array.isArray(res.data) || res.data.length === 0) {
                $('#productsGrid').hide();
                $('#noProducts').show();
                
                if (!res || !res.success) {
                    Utils.showError(
                        (res && (res.message || res.error)) || 'Failed to load brand products'
                    );
                }
                return;
            }
            
            renderProducts(res.data);
            $('#productsGrid').show();
            $('#noProducts').hide();
        },
        function(jqXHR) {
            $('#loadingSpinner').hide();
            $('#productsGrid').hide();
            $('#noProducts').show();
            
            const res = jqXHR && jqXHR.responseJSON;
            const msg = (res && (res.message || res.error)) ||
                        jqXHR.responseText ||
                        'Failed to load brand products';
            Utils.showError(msg);
        }
    );
}

// Render products
function renderProducts(products) {
    const container = $('#productsContainer');
    container.empty();
    
    products.forEach(product => {
        const productCard = ProductService.createProductCard(product);
        container.append(productCard);
    });
}

// Initialize page - this will be called by spapp's onReady (if configured) or on first load
function initBrandProducts() {
    loadBrandProducts();
}

// Listen for hash changes to reload products when staying on brand page
$(window).on('hashchange', function() {
    const hash = window.location.hash;
    if (hash.startsWith('#brand-products')) {
        loadBrandProducts();
    }
});
</script>
